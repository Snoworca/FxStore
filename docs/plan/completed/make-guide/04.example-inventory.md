---
name: FxStore 예제 코드 목록
description: 실전 예제와 테스트 코드에서 추출한 사용 패턴 목록
---

# 예제 코드 목록

## 1. 실전 예제 (docs/guide/07.examples/)

### 1.1 사용자 캐시 (user-cache.md)

**사용 사례**: 사용자 정보 캐시

```java
public class UserCache implements AutoCloseable {
    private final FxStore store;
    private final NavigableMap<Long, String> users;

    public UserCache(Path file) {
        this.store = FxStore.open(file);
        this.users = store.createOrOpenMap("users", Long.class, String.class);
    }

    public void put(long userId, String userData) {
        users.put(userId, userData);
    }

    public String get(long userId) {
        return users.get(userId);
    }

    public void remove(long userId) {
        users.remove(userId);
    }

    @Override
    public void close() {
        store.close();
    }
}
```

### 1.2 시계열 데이터 (time-series.md)

**사용 사례**: 타임스탬프 기반 로그/메트릭 저장

```java
public class TimeSeriesStore implements AutoCloseable {
    private final FxStore store;
    private final NavigableMap<Long, String> events;

    public TimeSeriesStore(Path file) {
        this.store = FxStore.open(file);
        this.events = store.createOrOpenMap("events", Long.class, String.class);
    }

    public void record(String event) {
        events.put(System.currentTimeMillis(), event);
    }

    public NavigableMap<Long, String> getRange(long fromTime, long toTime) {
        return events.subMap(fromTime, true, toTime, true);
    }

    public NavigableMap<Long, String> getLatest(int count) {
        NavigableMap<Long, String> result = new TreeMap<>();
        NavigableMap<Long, String> desc = events.descendingMap();
        int i = 0;
        for (Map.Entry<Long, String> entry : desc.entrySet()) {
            if (i++ >= count) break;
            result.put(entry.getKey(), entry.getValue());
        }
        return result;
    }

    @Override
    public void close() {
        store.close();
    }
}
```

### 1.3 작업 큐 (task-queue.md)

**사용 사례**: 영속적인 작업 큐

```java
public class PersistentTaskQueue implements AutoCloseable {
    private final FxStore store;
    private final Deque<String> tasks;

    public PersistentTaskQueue(Path file) {
        this.store = FxStore.open(file);
        this.tasks = store.createOrOpenDeque("tasks", String.class);
    }

    public void enqueue(String task) {
        tasks.addLast(task);
    }

    public String dequeue() {
        return tasks.pollFirst();
    }

    public String peek() {
        return tasks.peekFirst();
    }

    public int size() {
        return tasks.size();
    }

    public boolean isEmpty() {
        return tasks.isEmpty();
    }

    @Override
    public void close() {
        store.close();
    }
}
```

### 1.4 세션 저장소 (session-store.md)

**사용 사례**: 웹 애플리케이션 세션 저장

```java
public class SessionStore implements AutoCloseable {
    private final FxStore store;
    private final NavigableMap<String, String> sessions;

    public SessionStore(Path file) {
        FxOptions options = FxOptions.defaults()
            .withCommitMode(CommitMode.BATCH)
            .build();
        this.store = FxStore.open(file, options);
        this.sessions = store.createOrOpenMap(
            "sessions", String.class, String.class);
    }

    public void save(String sessionId, String data) {
        sessions.put(sessionId, data);
        store.commit();
    }

    public String load(String sessionId) {
        return sessions.get(sessionId);
    }

    public void delete(String sessionId) {
        sessions.remove(sessionId);
        store.commit();
    }

    public void deleteAll() {
        sessions.clear();
        store.commit();
    }

    @Override
    public void close() {
        store.close();
    }
}
```

## 2. 테스트 코드에서 추출한 패턴

### 2.1 기본 Store 열기/닫기

**출처**: `FxStoreTestBase.java`

```java
// 메모리 모드
FxStore memoryStore = FxStore.openMemory();

// 파일 모드
Path tempFile = Files.createTempFile("test", ".fx");
FxStore fileStore = FxStore.open(tempFile);

// 정리
memoryStore.close();
fileStore.close();
Files.delete(tempFile);
```

### 2.2 BATCH 모드 트랜잭션

**출처**: 다수 테스트

```java
FxOptions options = FxOptions.defaults()
    .withCommitMode(CommitMode.BATCH)
    .build();
FxStore store = FxStore.open(path, options);

try {
    NavigableMap<Long, String> map = store.createOrOpenMap(
        "test", Long.class, String.class);
    map.put(1L, "value");
    store.commit();
} catch (Exception e) {
    store.rollback();
    throw e;
} finally {
    store.close();
}
```

### 2.3 읽기 트랜잭션

**출처**: `FxReadTransactionEdgeCaseTest.java`

```java
try (FxReadTransaction tx = store.beginRead()) {
    String value = tx.get(map, key);
    boolean exists = tx.containsKey(map, key);
    Map.Entry<Long, String> first = tx.firstEntry(map);
    Map.Entry<Long, String> last = tx.lastEntry(map);
    int size = tx.size(map);
}
```

### 2.4 컬렉션 관리

**출처**: 다수 테스트

```java
// 컬렉션 존재 확인
boolean exists = store.exists("users");

// 컬렉션 삭제
store.drop("users");

// 이름 변경
store.rename("old_name", "new_name");

// 모든 컬렉션 조회
List<CollectionInfo> collections = store.list();
for (CollectionInfo info : collections) {
    System.out.println(info.name() + ": " + info.kind());
}
```

### 2.5 NavigableMap 범위 조회

**출처**: `FxNavigableMapCoverageTest.java`

```java
NavigableMap<Long, String> map = store.createOrOpenMap(
    "data", Long.class, String.class);

// 범위 조회
NavigableMap<Long, String> sub = map.subMap(10L, true, 20L, false);
NavigableMap<Long, String> head = map.headMap(50L, true);
NavigableMap<Long, String> tail = map.tailMap(50L, false);

// 역순
NavigableMap<Long, String> desc = map.descendingMap();

// 탐색
Long lower = map.lowerKey(50L);    // 50 미만 최대
Long floor = map.floorKey(50L);    // 50 이하 최대
Long ceiling = map.ceilingKey(50L); // 50 이상 최소
Long higher = map.higherKey(50L);   // 50 초과 최소
```

### 2.6 Deque 연산

**출처**: `FxDequeEdgeCaseTest.java`

```java
Deque<String> deque = store.createOrOpenDeque("queue", String.class);

// 앞/뒤 추가
deque.addFirst("first");
deque.addLast("last");
deque.offerFirst("offered");
deque.offerLast("offered");

// 앞/뒤 제거
String f = deque.pollFirst();
String l = deque.pollLast();
String rf = deque.removeFirst();
String rl = deque.removeLast();

// 조회 (제거 안함)
String pf = deque.peekFirst();
String pl = deque.peekLast();
```

### 2.7 통계 및 검증

**출처**: `VerifyApiTest.java`, `StatsTest.java`

```java
// 통계 조회
Stats stats = store.stats();
System.out.println("Page count: " + stats.pageCount());
System.out.println("Used bytes: " + stats.usedBytes());

// 상세 통계
Stats detailed = store.stats(StatsMode.DETAILED);

// 무결성 검증
VerifyResult result = store.verify();
if (result.isOk()) {
    System.out.println("Store is healthy");
} else {
    for (VerifyError error : result.errors()) {
        System.out.println("Error: " + error.kind() + " - " + error.message());
    }
}
```

### 2.8 컴팩션

**출처**: 통합 테스트

```java
// 컴팩션으로 공간 회수
Path newFile = Paths.get("data_compacted.fx");
store.compactTo(newFile);

// 새 파일로 열기
store.close();
store = FxStore.open(newFile);
```

## 3. 예제 작성 원칙

### 3.1 완전성
- 모든 import 포함
- main() 메서드 또는 테스트 메서드로 감싸기
- 예외 처리 포함
- 리소스 정리 (try-with-resources)

### 3.2 실용성
- 실제 사용 시나리오 반영
- 복사-붙여넣기로 즉시 실행 가능
- 적절한 에러 처리

### 3.3 점진적 복잡도
- 기본 → 중급 → 고급 순서
- 각 예제가 이전 예제 확장
