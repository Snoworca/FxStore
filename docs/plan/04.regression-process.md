# 회귀 테스트 프로세스 (Regression Test Process)

> **문서 버전:** 1.0  
> **목표:** 모든 테스트 통과 시까지 무한 반복

[← 목차로 돌아가기](00.index.md)

---

## 목차

- [회귀 테스트 원칙](#회귀-테스트-원칙)
- [회귀 테스트 범위](#회귀-테스트-범위)
- [실행 프로세스](#실행-프로세스)
- [실패 처리 프로세스](#실패-처리-프로세스)
- [회귀 테스트 체크리스트](#회귀-테스트-체크리스트)
- [자동화 스크립트](#자동화-스크립트)

---

## 회귀 테스트 원칙

### 1. 강제 실행
**코드 변경 시 반드시 전체 회귀 테스트를 실행해야 합니다.**

- 단일 테스트 실패 → 코드 개선 → **전체 회귀 테스트**
- 품질 기준 미달 → 코드 개선 → **전체 회귀 테스트**

### 2. 누적 테스트
**이전 Phase의 모든 테스트를 포함합니다.**

```
Phase 3 회귀 테스트 =
    Phase 0 테스트 +
    Phase 1 테스트 +
    Phase 2 테스트 +
    Phase 3 테스트
```

### 3. 무한 반복
**모든 테스트 통과 시까지 개선 → 재테스트를 반복합니다.**

```
코드 개선 → 회귀 테스트 → 실패? → 개선 → 회귀 테스트 → ...
                      → 성공 → 품질 평가
```

---

## 회귀 테스트 범위

### Phase별 누적 테스트

| Phase | 포함 테스트 | 예상 테스트 수 |
|-------|------------|--------------|
| 0 | Phase 0 | ~10개 |
| 1 | Phase 0-1 | ~30개 |
| 2 | Phase 0-2 | ~80개 |
| 3 | Phase 0-3 | ~150개 |
| 4 | Phase 0-4 | ~180개 |
| 5 | Phase 0-5 | ~250개 |
| 6 | Phase 0-6 | ~320개 |
| 7 | Phase 0-7 | ~400개 |

### 테스트 카테고리

각 Phase는 다음 카테고리의 테스트를 포함합니다:

1. **Unit Test**: 개별 클래스/메서드 테스트
2. **Integration Test**: 컴포넌트 간 상호작용 테스트
3. **Equivalence Test**: Java 표준 컬렉션과 비교
4. **Edge Case Test**: 경계 조건 테스트
5. **Property-Based Test**: 불변식 검증
6. **Fuzz Test**: 무작위 입력 크래시 검증 (Phase 7만)
7. **Performance Benchmark**: 성능 지표 측정 (Phase 7만)

---

## 실행 프로세스

### 1. 개발 중 (Day 1-6)

#### 1.1 단위 작업 완료 후
```bash
# 현재 작업 중인 클래스의 테스트만 실행
./gradlew test --tests "com.fxstore.codec.I64CodecTest"
```

#### 1.2 일일 종료 전
```bash
# 현재 Phase의 모든 테스트 실행
./gradlew test --tests "com.fxstore.codec.*"
```

### 2. Phase 완료 시 (Day 7)

#### 2.1 전체 회귀 테스트 실행
```bash
# 모든 Phase의 테스트 실행
./gradlew clean test
```

#### 2.2 커버리지 확인
```bash
./gradlew test jacocoTestReport
# build/reports/jacoco/test/html/index.html 확인
```

#### 2.3 결과 확인
```bash
# 테스트 결과 리포트
cat build/reports/tests/test/index.html
```

### 3. 실패 시

#### 3.1 실패 로그 분석
```bash
# 실패한 테스트 확인
grep "FAILED" build/test-results/test/*.xml
```

#### 3.2 코드 개선
- 실패 원인 파악
- 코드 수정 또는 리팩토링
- 필요 시 테스트 코드도 개선

#### 3.3 재테스트
```bash
# 전체 회귀 테스트 재실행
./gradlew clean test
```

#### 3.4 무한 반복
**모든 테스트 통과 시까지 3.1-3.3 반복**

---

## 실패 처리 프로세스

### 플로우차트

```
┌─────────────────────────────────────────────────────────┐
│                   회귀 테스트 실행                       │
└──────────────────┬──────────────────────────────────────┘
                   │
                   ▼
            ┌──────────────┐
            │ 모든 테스트   │
            │ 통과?        │
            └──────┬───────┘
                   │
         ┌─────────┴─────────┐
         │                   │
        예                  아니오
         │                   │
         ▼                   ▼
┌────────────────┐   ┌────────────────┐
│ 품질 평가       │   │ 실패 분석      │
└────────────────┘   └────────┬───────┘
                              │
                              ▼
                     ┌────────────────┐
                     │ 원인 분류      │
                     └────────┬───────┘
                              │
                ┌─────────────┼─────────────┐
                │             │             │
                ▼             ▼             ▼
        ┌──────────┐  ┌──────────┐  ┌──────────┐
        │ 버그     │  │ 설계     │  │ 테스트   │
        │ 수정     │  │ 변경     │  │ 개선     │
        └────┬─────┘  └────┬─────┘  └────┬─────┘
             │             │             │
             └─────────────┼─────────────┘
                           │
                           ▼
                  ┌────────────────┐
                  │ 코드 개선      │
                  └────────┬───────┘
                           │
                           ▼
                  ┌────────────────┐
                  │ 회귀 테스트    │
                  │ 재실행         │
                  └────────┬───────┘
                           │
                           └──────────┐
                                      │
                          (무한 반복) │
                                      ▼
```

### 실패 원인 분류

#### 1. 버그 (코드 오류)
**증상:**
- NullPointerException
- ArrayIndexOutOfBoundsException
- 잘못된 계산 결과

**처리:**
1. 버그 위치 파악
2. 코드 수정
3. 관련 테스트 강화 (재발 방지)
4. 전체 회귀 테스트

#### 2. 설계 변경
**증상:**
- 기존 테스트가 새 요구사항과 불일치
- API 시그니처 변경

**처리:**
1. 요구사항 재확인 (API 명세 확인)
2. 설계 조정 또는 테스트 조정
3. 전체 회귀 테스트

#### 3. 테스트 오류
**증상:**
- 테스트 코드 자체의 버그
- 잘못된 assertion

**처리:**
1. 테스트 코드 수정
2. 다른 테스트와 일관성 확인
3. 전체 회귀 테스트

---

## 회귀 테스트 체크리스트

### Phase별 체크리스트

#### Phase 0 완료 시
- [ ] ByteUtilsTest 모두 통과
- [ ] CRC32CTest 모두 통과
- [ ] FxExceptionTest 모두 통과
- [ ] 커버리지: 라인 100%, 브랜치 100%

#### Phase 1 완료 시
- [ ] **Phase 0 회귀 테스트 통과**
- [ ] I64CodecTest 모두 통과
- [ ] F64CodecTest 모두 통과
- [ ] StringCodecTest 모두 통과
- [ ] BytesCodecTest 모두 통과
- [ ] FxCodecRegistryTest 모두 통과
- [ ] 커버리지: 라인 100%, 브랜치 100%

#### Phase 2 완료 시
- [ ] **Phase 0-1 회귀 테스트 통과**
- [ ] FileStorageTest 모두 통과
- [ ] MemoryStorageTest 모두 통과
- [ ] SuperblockTest 모두 통과
- [ ] CommitHeaderTest 모두 통과
- [ ] SlottedPageTest 모두 통과
- [ ] PageCacheTest 모두 통과
- [ ] AllocatorTest 모두 통과
- [ ] 커버리지: 라인 90%+, 브랜치 85%+

#### Phase 3 완료 시
- [ ] **Phase 0-2 회귀 테스트 통과**
- [ ] BTreeLeafTest 모두 통과
- [ ] BTreeInternalTest 모두 통과
- [ ] BTreeFindTest 모두 통과
- [ ] BTreeInsertTest 모두 통과
- [ ] BTreeDeleteTest 모두 통과
- [ ] BTreeCursorTest 모두 통과
- [ ] BTreeEquivalenceTest 모두 통과
- [ ] 커버리지: 라인 95%+, 브랜치 90%+

#### Phase 4 완료 시
- [ ] **Phase 0-3 회귀 테스트 통과**
- [ ] CatalogEntryTest 모두 통과
- [ ] CollectionStateTest 모두 통과
- [ ] DDLTest 모두 통과
- [ ] 커버리지: 라인 100%, 브랜치 100%

#### Phase 5 완료 시
- [ ] **Phase 0-4 회귀 테스트 통과**
- [ ] FxNavigableMapTest 모두 통과
- [ ] FxNavigableSetTest 모두 통과
- [ ] FxDequeTest 모두 통과
- [ ] MapEquivalenceTest 모두 통과
- [ ] SetEquivalenceTest 모두 통과
- [ ] DequeEquivalenceTest 모두 통과
- [ ] CommitModeTest 모두 통과
- [ ] 커버리지: 라인 95%+, 브랜치 90%+

#### Phase 6 완료 시
- [ ] **Phase 0-5 회귀 테스트 통과**
- [ ] OSTNodeTest 모두 통과
- [ ] OSTGetTest 모두 통과
- [ ] OSTInsertTest 모두 통과
- [ ] OSTRemoveTest 모두 통과
- [ ] FxListTest 모두 통과
- [ ] ListEquivalenceTest 모두 통과
- [ ] 커버리지: 라인 95%+, 브랜치 90%+

#### Phase 7 완료 시
- [ ] **Phase 0-6 회귀 테스트 통과**
- [ ] StatsTest 모두 통과
- [ ] VerifyTest 모두 통과
- [ ] CompactTest 모두 통과
- [ ] CrashRecoveryTest 모두 통과
- [ ] OnClosePolicyTest 모두 통과
- [ ] FileLockTest 모두 통과
- [ ] EndToEndTest 모두 통과
- [ ] 커버리지: 라인 90%+, 브랜치 85%+

---

## 자동화 스크립트

### 회귀 테스트 스크립트 (regression.sh)

```bash
#!/bin/bash

# FxStore 회귀 테스트 스크립트

set -e  # 오류 시 중단

echo "=========================================="
echo "FxStore 회귀 테스트 시작"
echo "=========================================="

# 1. 클린 빌드
echo ""
echo "[1/5] 클린 빌드..."
./gradlew clean

# 2. 전체 테스트 실행
echo ""
echo "[2/5] 전체 테스트 실행..."
./gradlew test

# 3. 커버리지 리포트 생성
echo ""
echo "[3/5] 커버리지 리포트 생성..."
./gradlew jacocoTestReport

# 4. 결과 요약
echo ""
echo "[4/5] 결과 요약..."

# 테스트 실패 확인
FAILED=$(grep -c "FAILED" build/test-results/test/*.xml || echo "0")

if [ "$FAILED" -gt 0 ]; then
    echo ""
    echo "❌ 테스트 실패: $FAILED 개"
    echo ""
    echo "실패한 테스트 목록:"
    grep "FAILED" build/test-results/test/*.xml
    echo ""
    echo "다음 단계:"
    echo "1. 실패 로그 확인: build/reports/tests/test/index.html"
    echo "2. 코드 개선"
    echo "3. 회귀 테스트 재실행: ./regression.sh"
    exit 1
else
    echo ""
    echo "✅ 모든 테스트 통과"
fi

# 5. 커버리지 확인
echo ""
echo "[5/5] 커버리지 확인..."

# JaCoCo XML 파싱 (간단한 버전)
COVERAGE_XML="build/reports/jacoco/test/jacocoTestReport.xml"
if [ -f "$COVERAGE_XML" ]; then
    # 라인 커버리지 추출 (간략)
    echo "커버리지 리포트: build/reports/jacoco/test/html/index.html"
else
    echo "⚠ 커버리지 리포트를 찾을 수 없습니다."
fi

echo ""
echo "=========================================="
echo "회귀 테스트 완료 ✅"
echo "=========================================="
echo ""
echo "다음 단계:"
echo "1. 테스트 리포트 확인: build/reports/tests/test/index.html"
echo "2. 커버리지 리포트 확인: build/reports/jacoco/test/html/index.html"
echo "3. 품질 평가 진행"
```

### 사용 방법
```bash
# 실행 권한 부여
chmod +x regression.sh

# 회귀 테스트 실행
./regression.sh
```

---

## 성공 기준

### 회귀 테스트 통과 조건
다음 **모든** 조건을 만족해야 합니다:

1. ✅ **모든 테스트 통과** (실패 0개)
2. ✅ **커버리지 목표 달성**
   - 라인 커버리지: Phase별 목표 이상
   - 브랜치 커버리지: Phase별 목표 이상
3. ✅ **빌드 성공** (컴파일 오류 없음)
4. ✅ **정적 분석 통과** (선택, SpotBugs 등)

### 실패 시
- 원인 분석 → 코드 개선 → **회귀 테스트 재실행**
- **무한 반복** (모든 조건 만족 시까지)

---

## 회귀 테스트 주기

### 개발 중
- **일일**: 현재 Phase 테스트
- **주간**: 이전 Phase 포함 회귀 테스트

### Phase 완료 시
- **필수**: 전체 회귀 테스트
- **반복**: 모든 테스트 통과 시까지

### 프로젝트 완료 시 (Phase 7)
- **최종 회귀 테스트**: Phase 0-7 모두
- **릴리스 전 필수**

---

## 회귀 테스트 메트릭

### 추적 항목
- **총 테스트 수**: Phase별 누적
- **실패율**: 실패 테스트 / 전체 테스트
- **커버리지**: 라인, 브랜치
- **실행 시간**: 전체 회귀 테스트 소요 시간

### 목표
- 실패율: **0%** (모든 테스트 통과)
- 커버리지: Phase별 목표 달성
- 실행 시간: **10분 이내** (Phase 7 기준)

---

[← 목차로 돌아가기](00.index.md)
