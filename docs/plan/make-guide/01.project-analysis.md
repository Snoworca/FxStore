---
name: FxStore 프로젝트 분석
description: FxStore 코드베이스 구조, 아키텍처, 핵심 컴포넌트 분석 결과
---

# 프로젝트 분석

## 1. 프로젝트 구조

```
FxStore/
├── build.gradle              # Gradle 빌드 설정 (Java 8)
├── src/
│   ├── main/java/com/snoworca/fxstore/
│   │   ├── api/              # Public API (진입점)
│   │   ├── btree/            # B-Tree 구현
│   │   ├── catalog/          # 카탈로그 관리
│   │   ├── codec/            # 내장 코덱
│   │   ├── collection/       # 컬렉션 구현체
│   │   ├── core/             # 핵심 Store 구현
│   │   ├── migration/        # 데이터 마이그레이션
│   │   ├── ost/              # OST (Ordered String Table)
│   │   ├── storage/          # 저장소 추상화
│   │   └── util/             # 유틸리티
│   └── test/java/            # 테스트 코드
└── docs/                     # 문서
```

## 2. 핵심 Public API

### 2.1 진입점 (Entry Points)

| 클래스/인터페이스 | 설명 |
|------------------|------|
| `FxStore` | 메인 인터페이스, Store 열기/닫기 |
| `FxOptions` | 설정 빌더 |
| `FxCodec<T>` | 커스텀 코덱 인터페이스 |
| `FxReadTransaction` | 읽기 전용 트랜잭션 |

### 2.2 FxStore 메서드 분류

```
열기/닫기:
├── open(Path)
├── open(Path, FxOptions)
├── openMemory()
├── openMemory(FxOptions)
└── close()

컬렉션 DDL:
├── exists(String)
├── drop(String)
├── rename(String, String)
└── list()

Map 생성:
├── createMap(String, Class<K>, Class<V>)
├── openMap(String, Class<K>, Class<V>)
└── createOrOpenMap(String, Class<K>, Class<V>)

Set 생성:
├── createSet(String, Class<E>)
├── openSet(String, Class<E>)
└── createOrOpenSet(String, Class<E>)

List 생성:
├── createList(String, Class<E>)
├── openList(String, Class<E>)
└── createOrOpenList(String, Class<E>)

Deque 생성:
├── createDeque(String, Class<E>)
├── openDeque(String, Class<E>)
└── createOrOpenDeque(String, Class<E>)

커밋 제어:
├── commitMode()
├── commit()
└── rollback()

진단:
├── stats()
├── stats(StatsMode)
└── verify()

유지보수:
└── compactTo(Path)
```

### 2.3 지원 타입 (내장 코덱)

| 타입 | 코덱 ID | 설명 |
|------|--------|------|
| `Long` | `fx:i64` | 64비트 정수 |
| `Integer` | `fx:i32` | 32비트 정수 |
| `Short` | `fx:i16` | 16비트 정수 |
| `Byte` | `fx:i8` | 8비트 정수 |
| `Double` | `fx:f64` | 64비트 부동소수점 |
| `Float` | `fx:f32` | 32비트 부동소수점 |
| `String` | `fx:str` | UTF-8 문자열 |
| `byte[]` | `fx:bytes` | 바이트 배열 |

## 3. 설정 옵션 (FxOptions)

| 옵션 | 기본값 | 설명 |
|------|--------|------|
| `commitMode` | AUTO | AUTO/BATCH |
| `durability` | ASYNC | ASYNC/SYNC |
| `onClosePolicy` | ERROR | ERROR/COMMIT/ROLLBACK |
| `fileLock` | PROCESS | PROCESS/NONE |
| `pageSize` | 4K | 4K/8K/16K/32K/64K |
| `cacheBytes` | 64MB | 페이지 캐시 크기 |
| `allowCodecUpgrade` | false | 코덱 버전 업그레이드 허용 |
| `autoMigrateDeque` | false | Deque 자동 마이그레이션 |

## 4. 아키텍처 패턴

### 4.1 레이어 구조

```
┌─────────────────────────────────────┐
│         Application Layer           │
│  (NavigableMap, Set, List, Deque)   │
├─────────────────────────────────────┤
│         Collection Layer            │
│  (FxNavigableMapImpl, FxDequeImpl)  │
├─────────────────────────────────────┤
│           Index Layer               │
│      (BTree, OST - B+ Tree)         │
├─────────────────────────────────────┤
│          Storage Layer              │
│    (FileStorage, MemoryStorage)     │
└─────────────────────────────────────┘
```

### 4.2 COW (Copy-on-Write) 전략

```
쓰기 시:
1. 새 페이지 할당
2. 기존 데이터 복사 + 변경 적용
3. 새 루트 페이지 ID로 스냅샷 업데이트
4. 이전 스냅샷 참조하는 읽기는 영향 없음
```

### 4.3 스레드 안전성

- **Single Writer**: 쓰기는 Write Lock으로 보호
- **Wait-free Read**: 읽기는 스냅샷 기반 락 없이 수행
- **스냅샷 격리**: 읽기 트랜잭션은 시작 시점 스냅샷 고정

## 5. 테스트 분석

### 5.1 테스트 카테고리

| 카테고리 | 파일 수 | 설명 |
|----------|--------|------|
| API | 7 | Public API 테스트 |
| BTree | 7 | B-Tree 단위 테스트 |
| Collection | 15+ | 컬렉션 동작 테스트 |
| Integration | 10+ | 통합 테스트 |
| Core | 15+ | 핵심 기능 테스트 |

### 5.2 예제로 활용 가능한 테스트

- `FxStoreTestBase.java`: 기본 사용 패턴
- `FxNavigableMapCoverageTest.java`: Map 전체 API
- `FxDequeEdgeCaseTest.java`: Deque 사용법
- `FxReadTransactionEdgeCaseTest.java`: 읽기 트랜잭션

## 6. 기존 문서 분석

### 6.1 설계 문서 (docs/plan/)

- 구현 단계별 계획 문서 다수
- 품질 평가 문서
- 버그 수정 계획 및 보고서

### 6.2 용어 및 컨벤션

- **INV-**: 불변식 (Invariant) 접두어
- **CONC-**: 동시성 관련 식별자
- **PERF-**: 성능 관련 식별자
- **BUG-**: 버그 수정 식별자
